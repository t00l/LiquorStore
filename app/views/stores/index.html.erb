<<<<<<< HEAD
=======
<style>
#DemoModal {
top:5%;
right:50%;
outline: none;
}
</style>

<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">

<!-- Optional theme -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css">

<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
  <%= render 'shared/navbar' %>
>>>>>>> c1dfa67... Added modals with stores info and routes, fixed open and closed icons
  <p id="notice"><%= notice %></p>

  <div id="demo">
  </div>

  <div class="map_container">
    <div id="geolocation" class="geolocation"></div>
  </div>

  <br>

  <script src="//maps.google.com/maps/api/js?v=3.13&amp;sensor=false&amp;libraries=geometry" type="text/javascript"></script>

  <script src='//google-maps-utility-library-v3.googlecode.com/svn/tags/markerclustererplus/2.0.14/src/markerclusterer_packed.js' type='text/javascript'></script>

  <script>


  var handler = Gmaps.build('Google');



  function initialize(){

    handler.buildMap({ internal: {id: 'geolocation'} }, function() {
      
      markers_json = <%=raw @hash.to_json %>;
      markers = _.map(markers_json, function(marker_json){

        marker = handler.addMarker(marker_json);
        _.extend(marker, marker_json);

        return marker;
      });

      getLocation();

      markers.map(function(elem, index) {

        google.maps.event.addListener(elem.getServiceObject(), "click", function(evt) {

          var name = elem.store_name;
          var schedule = elem.store_schedule;
          var image = elem.store_image
          var address = elem.store_address

          $(".clase").html("<h1>"+name+"</h1>")
          $(".clase2").html("<h2>"+schedule+"</h2>")
          $(".clase3").html("<img src="+image+">")
          $(".clase4").html("<p>"+address+"</p>")
          $( "#target" ).click(function() {
            showRoute(marker2, elem);
          });

          $('#DemoModal').modal('show');
          $('.modal-backdrop').removeClass("modal-backdrop");

          $('#DemoModal').on('hidden.bs.modal', function () {
            directionsDisplay.setMap(null);
            handler.map.centerOn(marker2);
            handler.getMap().setZoom(14);
          })


        });
      })

    });
  }

  function getLocation(){
    if(navigator.geolocation){
      navigator.geolocation.getCurrentPosition(displayOnMap);
    }
    else{
      navigator.geolocation.getCurrentPosition(displayOnMapError);
    }
  };

  // var markerLocation;

  function displayOnMap(position){
    
    marker2 = handler.addMarker({

      lat: position.coords.latitude,
      lng: position.coords.longitude,

      picture: {
          url: "<%= image_url('cat.png') %>",
          width:  36,
          height: 36
          },
      infowindow:  "aaa"
    });

    handler.map.centerOn(marker2);
    handler.getMap().setZoom(14);
  };

  function displayOnMapError(position){
    
    marker2 = handler.addMarker({

      lat: -33.469120,
      lng: -70.641997,

      picture: {
          url: "<%= image_url('cat.png') %>",
          width:  36,
          height: 36
          }
    });
    handler.map.centerOn(marker2);
    handler.getMap().setZoom(15);
  };

<<<<<<< HEAD
  </script>
=======
  

  var directionsDisplay = new google.maps.DirectionsRenderer();
  var directionsService = new google.maps.DirectionsService();

  function calcRoute(origin, destination) {
    // var origin      = new google.maps.LatLng(-33.469120, -70.641997);
    // var destination = new google.maps.LatLng(-33.589120, -70.761997);
    var request = {
        origin:      origin,
        destination: destination,
        travelMode:  google.maps.TravelMode.DRIVING
    };
    directionsService.route(request, function(response, status) {
      if (status == google.maps.DirectionsStatus.OK) {
        directionsDisplay.setDirections(response);
      }
    });
  }

  function showRoute(locationMarker, destinationMarker){
    currentLat = locationMarker.serviceObject.position.k;
    currentLng = locationMarker.serviceObject.position.D;
    var origin = new google.maps.LatLng(currentLat, currentLng);
    var destination = new google.maps.LatLng(destinationMarker.lat, destinationMarker.lng);

    calcRoute(origin, destination);
    directionsDisplay.setMap(handler.getMap());
  }

  initialize();


  </script>
  
</div>
<div style="padding-bottom:100px;padding-left:20px;padding-right:20px;"><a name="grupo" style="text-decoration:none;"><h3 style="text-align:center;">Quiénes somos</h3></a>
<p>Lorem ipsum dolor sit cuchuflí barquillo bacán jote gamba listeilor po cahuín, luca melón con vino pichanga coscacho ni ahí peinar la muñeca chuchada al chancho achoclonar. Chorrocientos pituto ubicatex huevo duro bolsero cachureo el hoyo del queque en cana huevón el año del loly hacerla corta impeque de miedo quilterry la raja longi ñecla. Hilo curado rayuela carrete quina guagua lorea piola ni ahí.</p>
<p>Lorem ipsum dolor sit cuchuflí barquillo bacán jote gamba listeilor po cahuín, luca melón con vino pichanga coscacho ni ahí peinar la muñeca chuchada al chancho achoclonar. Chorrocientos pituto ubicatex huevo duro bolsero cachureo el hoyo del queque en cana huevón el año del loly hacerla corta impeque de miedo quilterry la raja longi ñecla. Hilo curado rayuela carrete quina guagua lorea piola ni ahí.</p>
</div>

<h3 style="text-align:center;"><a name="contacto" style="text-decoration:none;background-color:white;">Contáctanos</h3>
<div style="margin-left:auto; margin-right:auto; width: 20%; padding: 10px;">

  <img src="http://png-3.findicons.com/files/icons/1979/social/50/facebook.png">
  <img src="http://www.albertrossell.com/wp-content/imatges/twitter50x50.png">
  <img src="http://megaicons.net/static/img/icons_sizes/8/178/48/logos-github-icon.png"></a>

</div>

<!-- <script>
$(document).ready(function(){
  $('.open-modal').click(function(){
    $('#DemoModal').modal('show');
    $('.modal-backdrop').removeClass("modal-backdrop");    
  }); 
});
</script> -->


<!-- Launch Button -->
<!-- <input type="button" class="btn btn-lg btn-primary open-modal" value="Launch Modal"> -->

<!-- Modal Contents -->
<div id="DemoModal" class="modal fade">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
  
        <button type="button" class="close" data-dismiss="modal"
        aria-hidden="true">×</button>
  
        <h4 class="modal-title">Botilleria!!</h4>
      </div>
  
      <div class="modal-body">
        <!-- <p>Your software Version is Old, a new version of the software is available.</p>
        <p class="text-warning"><small>Would you like to download it now.</small></p> -->
        <div class="clase"></div>
        <div class="clase2"></div>
        <div class="clase3"></div>
        <div class="clase4"></div>
      </div>
  
      <div class="modal-footer">
        <button type="button" class="btn btn-default" id="target" >Trazar Ruta</button>
        <button type="button" class="btn btn-default" data-dismiss="modal">Later</button>
      </div>
  
    </div>
  </div>
</div>

>>>>>>> c1dfa67... Added modals with stores info and routes, fixed open and closed icons
