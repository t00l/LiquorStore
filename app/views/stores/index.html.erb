<div class="container-fluid">

  <p id="notice"><%= notice %></p>

  <h1>Botillerias cercanas !</h1>

  <div id="demo">
  </div>

  <div class="map_container">
    <div id="geolocation" class="geolocation"></div>
  </div>

  <br>

  <script src="//maps.google.com/maps/api/js?v=3.13&amp;sensor=false&amp;libraries=geometry" type="text/javascript"></script>

  <script src='//google-maps-utility-library-v3.googlecode.com/svn/tags/markerclustererplus/2.0.14/src/markerclusterer_packed.js' type='text/javascript'></script>

  <script>
  var handler = Gmaps.build('Google');

  handler.buildMap({ internal: {id: 'geolocation'} }, function(){
    marker = handler.addMarkers(<%=raw @hash.to_json %>);
    if(navigator.geolocation)
      navigator.geolocation.getCurrentPosition(displayOnMap);
    else
      navigator.geolocation.getCurrentPosition(displayOnMapError);

  });

  function displayOnMap(position){
    
    marker2 = handler.addMarker({

      lat: position.coords.latitude,
      lng: position.coords.longitude,

      picture: {
          url: "http://findicons.com/files/icons/2579/iphone_icons/40/cat.png",
          width:  36,
          height: 36
          },
      infowindow: "hola"
    });
    handler.map.centerOn(marker2);
    handler.getMap().setZoom(15);
  };

  function displayOnMapError(position){
    
    marker2 = handler.addMarker({

      lat: -33.469120,
      lng: -70.641997,

      picture: {
          url: "http://findicons.com/files/icons/2579/iphone_icons/40/cat.png",
          width:  36,
          height: 36
          }
    });
    handler.map.centerOn(marker2);
    handler.getMap().setZoom(15);
  };




  </script>

  <table class="table table-hover">
    <thead>
      <tr>
        <th>Nombre</th>
        <th>Dirección</th>
        <th>Horario</th>
        <th>Usuario</th>
        <th colspan="3">Acción</th>
      </tr>
    </thead>

    <tbody>
      <% @stores.each do |store| %>
        <tr>
          <td><%= store.name %></td>
          <td><%= store.address %></td>
          <td><%= store.schedule %></td>
          <td><%= store.user %></td>
          <td><%= link_to 'Mostrar', store %></td>
          <td><%= link_to 'Editar', edit_store_path(store) %></td>
          <td><%= link_to 'Eliminar', store, method: :delete, data: { confirm: 'Are you sure?' } %></td>
        </tr>
      <% end %>
    </tbody>
  </table>

  <br>

  <%= link_to 'New Store', new_store_path %>
  
</div>